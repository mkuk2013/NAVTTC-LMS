<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Certificate - BBSHRRDB LMS</title>
    <link rel="icon" href="assets/bbsydp_logo.png" type="image/png">

    <!-- Core Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script>
        window.jsPDF = window.jspdf ? window.jspdf.jsPDF : window.jsPDF;
    </script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        @keyframes stamp {
            0% { opacity: 0; transform: scale(5); }
            50% { opacity: 1; transform: scale(0.8); }
            70% { transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        .stamp-animate {
            animation: stamp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            animation-delay: 0.5s;
        }
        .glass-premium {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }
        .gradient-text {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(135deg, #4f46e5, #9333ea);
        }
        @keyframes updown {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-updown {
            animation: updown 2.5s ease-in-out infinite;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        indigo: { 50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95', 950: '#2e1065' },
                        slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#020617' },
                        emerald: { 50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399', 500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b', 950: '#022c22' }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        display: ['Cinzel', 'serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col relative overflow-x-hidden selection:bg-indigo-100 selection:text-indigo-700">
    <!-- Global Loader -->
    <div id="global-loader" class="fixed inset-0 z-[9999] bg-slate-50 dark:bg-[#0b1120] flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="relative flex flex-col items-center translate-y-16">
            <!-- Logo with UpDown Animation -->
            <div class="animate-updown -mb-5 relative">
                 <img src="assets/bbsydp_logo.png" alt="BBSHRRDB Logo" class="w-32 h-32 object-contain relative z-10">
            </div>
            
            <!-- Loading Text -->
            <div class="flex flex-col items-center gap-2">
                <span class="text-xs font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-[0.3em] animate-pulse">Please wait loading...</span>
            </div>
        </div>
    </div>

    <!-- Background Gradients -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-200/30 rounded-full blur-[120px] animate-pulse"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-200/30 rounded-full blur-[120px] animate-pulse delay-1000"></div>
    </div>

    <!-- Navbar -->
    <nav class="bg-white/70 backdrop-blur-xl border-b border-slate-200 sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3 group cursor-pointer">
                    <div class="p-1 relative">
                        <div class="absolute inset-0 bg-indigo-500 rounded-lg blur opacity-20 group-hover:opacity-40 transition-opacity"></div>
                        <img src="assets/bbsydp_logo.png" class="w-10 h-10 object-contain relative z-10 transform group-hover:scale-110 transition-transform" alt="Logo">
                    </div>
                    <div>
                        <h1 class="font-bold text-lg tracking-tight text-slate-900 group-hover:text-indigo-900 transition-colors">BBSHRRDB <span class="text-indigo-600">Verification</span></h1>
                    </div>
                </div>
                <a href="index.html" class="text-sm font-bold text-slate-500 hover:text-indigo-600 transition-all flex items-center gap-2 px-4 py-2 rounded-full hover:bg-indigo-50">
                    <i data-lucide="home" class="w-4 h-4"></i>
                    Back to Home
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-12 max-w-3xl relative z-10">
        
        <div class="text-center mb-12">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-50 border border-indigo-100 text-indigo-600 text-[10px] font-black uppercase tracking-widest mb-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 animate-pulse"></span>
                Official System
            </div>
            <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-4 tracking-tight animate-in fade-in slide-in-from-bottom-5 duration-700">Certificate <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">Verification</span></h1>
            <p class="text-lg text-slate-500 max-w-lg mx-auto animate-in fade-in slide-in-from-bottom-6 duration-900">Instantly verify the authenticity of any BBSHRRDB issued certificate by entering the ID or scanning the QR code.</p>
        </div>

        <!-- Verification Card -->
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl shadow-indigo-100/50 overflow-hidden border border-white/50 ring-1 ring-slate-900/5 animate-in fade-in zoom-in-95 duration-700 delay-200">
            
            <!-- Tabs -->
            <div class="p-2 bg-slate-100/50 border-b border-slate-200/50">
                <div class="flex p-1 bg-slate-200/50 rounded-xl relative">
                    <!-- Tab Background Animation (Simple Toggle for now, advanced requires JS calc) -->
                    <button onclick="switchTab('id')" id="tab-id" class="flex-1 py-3 text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2 shadow-sm bg-white text-indigo-600 ring-1 ring-black/5">
                        <i data-lucide="hash" class="w-4 h-4"></i>
                        Certificate ID
                    </button>
                    <button onclick="switchTab('qr')" id="tab-qr" class="flex-1 py-3 text-sm font-bold rounded-lg text-slate-500 hover:text-slate-700 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="scan-line" class="w-4 h-4"></i>
                        Upload QR / PDF
                    </button>
                </div>
            </div>

            <div class="p-8 md:p-10">
                
                <!-- ID Input Section -->
                <div id="section-id" class="space-y-8">
                    <div>
                        <label for="cert-id-input" class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">Certificate ID Number</label>
                        <div class="relative group">
                            <input type="text" id="cert-id-input" placeholder="BBS-HTML-2026-XXXX" 
                                class="w-full px-5 py-4 pl-12 bg-slate-50 border-2 border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono font-bold text-lg uppercase tracking-widest placeholder:text-slate-300 placeholder:normal-case">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none text-slate-400 group-focus-within:text-indigo-500 transition-colors">
                                <i data-lucide="search" class="w-5 h-5"></i>
                            </div>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                                <span class="text-xs font-bold text-slate-300 border border-slate-200 rounded px-1.5 py-0.5">ESC</span>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-3 ml-1 flex items-center gap-1.5">
                            <i data-lucide="info" class="w-3 h-3"></i>
                            ID can be found on the top right corner of the certificate
                        </p>
                    </div>
                    <button onclick="verifyCertificate()" class="w-full py-4 px-6 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold text-lg rounded-2xl shadow-xl shadow-indigo-500/30 transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 group">
                        <span>Verify Certificate</span>
                        <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </div>

                <!-- QR Scan Section -->
                <div id="section-qr" class="hidden space-y-6">
                    <div class="group relative border-2 border-dashed border-slate-300 rounded-3xl p-12 flex flex-col items-center justify-center text-center hover:border-indigo-500 hover:bg-indigo-50/30 transition-all cursor-pointer overflow-hidden" onclick="document.getElementById('qr-input-file').click()">
                        <!-- Background Pattern -->
                        <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                            <div class="absolute inset-0 bg-[radial-gradient(#818cf8_1px,transparent_1px)] [background-size:16px_16px] [mask-image:radial-gradient(ellipse_50%_50%_at_50%_50%,#000_70%,transparent_100%)]"></div>
                        </div>

                        <div class="relative z-10">
                            <div class="w-20 h-20 bg-indigo-50 group-hover:bg-white text-indigo-500 group-hover:text-indigo-600 rounded-2xl flex items-center justify-center mb-6 transition-all shadow-sm group-hover:shadow-md group-hover:scale-110 duration-300">
                                <i data-lucide="upload-cloud" class="w-10 h-10"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-900 mb-2">Click to Upload</h3>
                            <p class="text-slate-500 text-sm mb-8 max-w-xs mx-auto leading-relaxed">Select your certificate PDF file or a clear image of the QR code.</p>
                            
                            <div class="inline-flex items-center gap-2 px-5 py-2.5 bg-white border border-slate-200 rounded-xl shadow-sm text-sm font-bold text-slate-700 group-hover:border-indigo-200 group-hover:text-indigo-600 transition-all">
                                <i data-lucide="file-up" class="w-4 h-4"></i>
                                Browse Files
                            </div>
                        </div>
                        
                        <input type="file" id="qr-input-file" accept="image/*,application/pdf" class="hidden" onchange="scanFromFile(this)">
                    </div>
                    <div class="text-center">
                         <p class="text-xs text-slate-400">Supports JPG, PNG and PDF formats</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Result Section -->
        <div id="result-container" class="mt-12 hidden animate-slide-up scroll-mt-24">
            
            <!-- Valid Certificate -->
            <div id="result-valid" class="hidden animate-in fade-in zoom-in-95 duration-500">
                <div class="bg-white rounded-xl shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
                    <!-- Top colored bar -->
                    <div class="bg-gradient-to-r from-emerald-600 to-teal-600 h-2 w-full"></div>
                    
                    <div class="p-8 md:p-10 relative">
                        <!-- Watermark -->
                        <div class="absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none">
                            <img src="assets/bbsydp_logo.png" class="w-96 h-96 object-contain grayscale">
                        </div>

                        <div class="relative z-10">
                            <!-- Header -->
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 border-b border-slate-100 pb-6">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-3">
                                        <div class="bg-emerald-100 p-2 rounded-full text-emerald-600">
                                            <i data-lucide="shield-check" class="w-6 h-6"></i>
                                        </div>
                                        Verification Successful
                                    </h2>
                                    <p class="text-slate-500 text-sm mt-1 ml-11">This certificate is valid and registered in the national database.</p>
                                </div>
                                <div class="mt-4 md:mt-0 px-4 py-2 bg-emerald-50 text-emerald-700 text-xs font-black uppercase tracking-widest rounded-lg border border-emerald-100 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                    Official Record
                                </div>
                            </div>

                            <!-- Content Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
                                <!-- Left: Student Info -->
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5">Student Name</label>
                                        <div class="text-xl font-bold text-slate-900 font-serif" id="res-name">Student Name</div>
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5">Course / Program</label>
                                        <div class="text-base font-semibold text-slate-700 flex items-center gap-2">
                                            <i data-lucide="award" class="w-4 h-4 text-indigo-500"></i>
                                            HTML5 Web Development
                                        </div>
                                    </div>
                                     <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5">Certificate ID</label>
                                        <div class="font-mono text-sm font-bold text-slate-600 bg-slate-50 px-3 py-1.5 rounded-lg inline-block border border-slate-200 select-all" id="res-id">BBS-HTML-2026-XXXX</div>
                                    </div>
                                </div>

                                <!-- Right: Exam Details -->
                                <div class="space-y-6">
                                     <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5">Examination Date</label>
                                        <div class="text-lg font-semibold text-slate-700" id="res-date">Jan 01, 2026</div>
                                    </div>
                                     <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5">Score Achieved</label>
                                        <div class="flex items-center gap-3">
                                             <div class="text-3xl font-black text-slate-900" id="res-score">95%</div>
                                             <div class="h-2.5 w-32 bg-slate-100 rounded-full overflow-hidden border border-slate-100">
                                                 <div id="res-progress-fill" class="h-full bg-emerald-500 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)] transition-all duration-1000 ease-out" style="width: 0%"></div>
                                             </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Official Seal Area -->
                            <div class="mt-10 pt-8 border-t border-slate-100 flex flex-col md:flex-row items-center justify-between gap-6">
                                <div class="flex items-center gap-4">
                                    <img src="assets/bbsydp_logo.png" class="w-12 h-12 object-contain opacity-80 grayscale hover:grayscale-0 transition-all">
                                    <div class="flex flex-col">
                                        <span class="text-xs font-black text-slate-900 uppercase tracking-tight">BBSHRRDB Official Record</span>
                                        <span class="text-[10px] text-slate-500 font-medium">Digitally Verified & Timestamped</span>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="flex gap-3 w-full md:w-auto">
                                    <button onclick="location.reload()" class="flex-1 md:flex-none py-2.5 px-5 bg-white border border-slate-200 text-slate-600 text-sm font-bold rounded-lg hover:bg-slate-50 hover:text-slate-900 transition-all">
                                        Check Another
                                    </button>
                                    <button onclick="downloadReport()" class="flex-1 md:flex-none py-2.5 px-5 bg-slate-900 text-white text-sm font-bold rounded-lg hover:bg-slate-800 transition-all shadow-lg shadow-slate-900/20 flex items-center justify-center gap-2">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                        Download Report
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Animated Stamp -->
                            <div class="absolute top-24 right-1 opacity-0 stamp-animate delay-500 hidden md:block pointer-events-none">
                                <img src="assets/stamp.png" class="w-32 h-32 object-contain opacity-80 mix-blend-multiply transform -rotate-45" alt="Verified Stamp">
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invalid Certificate -->
            <div id="result-invalid" class="hidden animate-in fade-in zoom-in-95 duration-500">
                <div class="bg-white rounded-xl shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
                    <div class="bg-rose-600 h-2 w-full"></div>
                    <div class="p-8 md:p-10 text-center relative z-10">
                        <div class="w-24 h-24 bg-rose-50 text-rose-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                            <i data-lucide="shield-alert" class="w-12 h-12"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-slate-900 mb-2">Verification Failed</h2>
                        <p class="text-slate-500 max-w-md mx-auto mb-10 text-lg">We could not find a valid certificate record matching the provided details.</p>
                        
                        <div class="bg-rose-50 border border-rose-100 rounded-xl p-6 text-left max-w-lg mx-auto mb-10">
                            <h4 class="font-bold text-rose-800 text-sm mb-3 flex items-center gap-2">
                                <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                                Possible Reasons:
                            </h4>
                            <ul class="text-sm text-rose-700 space-y-2 list-disc pl-5">
                                <li>The Certificate ID was entered incorrectly.</li>
                                <li>The QR code is damaged or low quality.</li>
                                <li>The certificate has been revoked or expired.</li>
                                <li>The record does not exist in the BBSHRRDB database.</li>
                            </ul>
                        </div>

                        <button onclick="location.reload()" class="py-3 px-8 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-all shadow-xl shadow-slate-900/20 hover:-translate-y-1">
                            Try Again
                        </button>
                    </div>
                    
                    <!-- Watermark -->
                    <div class="absolute inset-0 flex items-center justify-center opacity-[0.02] pointer-events-none">
                        <i data-lucide="shield-alert" class="w-96 h-96 text-rose-900"></i>
                    </div>
                </div>
            </div>


        </div>

        <!-- Trust Badges -->
        <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6 text-center animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-300">
            <div class="flex flex-col items-center">
                <div class="w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center mb-3">
                    <i data-lucide="shield-check" class="w-5 h-5"></i>
                </div>
                <h3 class="text-sm font-bold text-slate-900">Secure Verification</h3>
                <p class="text-xs text-slate-500 mt-1">256-bit encrypted database lookup</p>
            </div>
            <div class="flex flex-col items-center">
                <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mb-3">
                    <i data-lucide="zap" class="w-5 h-5"></i>
                </div>
                <h3 class="text-sm font-bold text-slate-900">Instant Results</h3>
                <p class="text-xs text-slate-500 mt-1">Real-time validation engine</p>
            </div>
            <div class="flex flex-col items-center">
                <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center mb-3">
                    <i data-lucide="database" class="w-5 h-5"></i>
                </div>
                <h3 class="text-sm font-bold text-slate-900">Official Registry</h3>
                <p class="text-xs text-slate-500 mt-1">Direct access to student records</p>
            </div>
        </div>

    </main>

    <!-- Global Footer -->
    <footer class="mt-auto py-6 px-4 md:px-8">
        <div class="bg-white dark:bg-[#1e293b] border border-slate-200 dark:border-slate-800 rounded-2xl p-4 md:p-5 flex flex-col md:flex-row items-center justify-between gap-4 shadow-sm relative overflow-hidden group">

            <!-- Decorative Gradient Pulse -->
            <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-indigo-500 via-purple-500 to-indigo-500 opacity-50 group-hover:opacity-100 transition-opacity">
            </div>

            <!-- Left: System Identity -->
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center p-2 border border-indigo-100 dark:border-indigo-900/30">
                    <img src="assets/bbsydp_logo.png" class="w-full h-full object-contain">
                </div>
                <div class="flex flex-col">
                    <span class="text-xs font-black text-slate-800 dark:text-slate-100 uppercase tracking-tight leading-none mb-1">BBSHRRDB LMS <span class="text-indigo-500 text-[10px] ml-1">v2.0</span></span>
                    <span class="text-[9px] font-bold text-slate-400 uppercase tracking-wider leading-none">Â© <span class="dynamic-year">2026</span> Super Systech Computers Umerkot</span>
                </div>
            </div>

            <!-- Right: Creator Identity & Status -->
            <div class="flex flex-col md:flex-row items-center gap-3 md:gap-6">

                <div class="flex flex-col items-center md:items-end">
                    <div class="text-[8px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-0.5">Designed & Developed By</div>
                    <div class="flex items-center gap-1.5">
                        <span class="text-[11px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest">Mukesh Kumar</span>
                        <i data-lucide="badge-check" class="w-3.5 h-3.5 text-indigo-500 fill-indigo-100 dark:fill-indigo-900/50"></i>
                    </div>
                </div>

                <div class="hidden md:block w-px h-8 bg-slate-100 dark:bg-slate-800"></div>

                <div class="flex items-center gap-2 px-3 py-1.5 bg-emerald-50 dark:bg-emerald-500/10 rounded-lg border border-emerald-100 dark:border-emerald-500/20">
                    <div class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                    </div>
                    <span class="text-[9px] font-black uppercase text-emerald-600 dark:text-emerald-400 tracking-wider">Online</span>
                </div>
            </div>

        </div>
    </footer>

    <!-- Hidden element for file scanning -->
    <div id="file-reader" class="hidden"></div>

    <!-- Scripts -->
    <script>
        // Supabase Setup
        const SUPABASE_URL = "https://oaycnrsbrgancgrxhztd.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9heWNucnNicmdhbmNncnhoenRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNjIyMzIsImV4cCI6MjA4MTczODIzMn0.Md8TTNA7nY504_STka-04BM9WAoVZ32J_-JCirAGgC4";
        const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // UI Logic
        lucide.createIcons();

        function switchTab(tab) {
            const activeClasses = ['shadow-sm', 'bg-white', 'text-indigo-600', 'ring-1', 'ring-black/5'];
            const inactiveClasses = ['text-slate-500', 'hover:text-slate-700'];

            if (tab === 'id') {
                document.getElementById('section-id').classList.remove('hidden');
                document.getElementById('section-qr').classList.add('hidden');
                
                const tabId = document.getElementById('tab-id');
                const tabQr = document.getElementById('tab-qr');
                
                tabId.classList.add(...activeClasses);
                tabId.classList.remove(...inactiveClasses);
                
                tabQr.classList.remove(...activeClasses);
                tabQr.classList.add(...inactiveClasses);
                
            } else {
                document.getElementById('section-id').classList.add('hidden');
                document.getElementById('section-qr').classList.remove('hidden');
                
                const tabId = document.getElementById('tab-id');
                const tabQr = document.getElementById('tab-qr');
                
                tabQr.classList.add(...activeClasses);
                tabQr.classList.remove(...inactiveClasses);
                
                tabId.classList.remove(...activeClasses);
                tabId.classList.add(...inactiveClasses);
            }
        }

        async function downloadReport() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Get data
                const name = document.getElementById('res-name').textContent;
                const score = document.getElementById('res-score').textContent;
                const certId = document.getElementById('res-id').textContent;
                const issueDate = document.getElementById('res-date').textContent;
                const verifyDate = new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', month: 'long', day: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });
                
                // Header Background
                doc.setFillColor(15, 23, 42); // Slate 900
                doc.rect(0, 0, 210, 40, 'F');
                
                // Header Text
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.text("BBSHRRDB LMS", 20, 20);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text("Official Verification Report", 20, 30);

                doc.setTextColor(200, 200, 200);
                doc.text("Generated on: " + verifyDate, 190, 25, { align: 'right' });
                
                // Content Container
                doc.setDrawColor(203, 213, 225); // Slate 300
                doc.setFillColor(255, 255, 255);
                doc.roundedRect(20, 55, 170, 110, 3, 3, 'S');
                
                // Title
                doc.setTextColor(33, 33, 33);
                doc.setFontSize(22);
                doc.setFont('helvetica', 'bold');
                doc.text("Verification Successful", 105, 75, { align: 'center' });
                
                // Status Badge
                doc.setFillColor(220, 252, 231); // Green 100
                doc.setDrawColor(22, 163, 74); // Green 600
                doc.roundedRect(85, 82, 40, 10, 2, 2, 'FD');
                doc.setTextColor(22, 163, 74);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text("VALID RECORD", 105, 88.5, { align: 'center' });
                
                // Details
                const startX = 40;
                let startY = 110;
                const lineHeight = 12;
                
                // Helper for rows
                const addRow = (label, value) => {
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(100, 116, 139); // Slate 500
                    doc.text(label, startX, startY);
                    
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(15, 23, 42); // Slate 900
                    doc.text(value, startX + 60, startY);
                    
                    // Dotted line
                    doc.setDrawColor(226, 232, 240);
                    doc.setLineDash([1, 1], 0);
                    doc.line(startX, startY + 4, 170, startY + 4);
                    doc.setLineDash([]);
                    
                    startY += lineHeight;
                };
                
                addRow("Student Name", name);
                addRow("Certificate ID", certId);
                addRow("Course Score", score);
                addRow("Issue Date", issueDate);
                addRow("Course", "HTML5 Web Development"); // Hardcoded for now based on context
                
                // Footer
                doc.setFont('helvetica', 'italic');
                doc.setTextColor(148, 163, 184); // Slate 400
                doc.setFontSize(9);
                doc.text("This document certifies that the above record exists in the BBSHRRDB database.", 105, 180, { align: 'center' });
                doc.text("To verify online, visit: " + window.location.origin + window.location.pathname + "?id=" + certId, 105, 185, { align: 'center' });
                
                // Save
                doc.save(`BBSHRRDB_Verification_${certId}.pdf`);

            } catch (err) {
                console.error("Report Generation Error:", err);
                alert("Could not generate report. Please try again.");
            }
        }

        // Verification Logic
        async function verifyCertificate(id = null) {
            const certId = id || document.getElementById('cert-id-input').value.trim();
            if (!certId) return;

            // Reset UI State
            const container = document.getElementById('result-container');
            const validCard = document.getElementById('result-valid');
            const invalidCard = document.getElementById('result-invalid');
            const verifyBtn = document.querySelector('button[onclick="verifyCertificate()"]');
            
            // Show loading state
            verifyBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i><span>Verifying...</span>';
            verifyBtn.disabled = true;
            
            container.classList.add('hidden');
            validCard.classList.add('hidden');
            invalidCard.classList.add('hidden');

            try {
                const { data, error } = await client
                    .from('exam_results')
                    .select('*')
                    .eq('certificate_id', certId)
                    .single();

                // Restore button state
                verifyBtn.innerHTML = '<span>Verify Certificate</span><i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>';
                verifyBtn.disabled = false;

                container.classList.remove('hidden');

                if (data) {
                    // Valid Case
                    invalidCard.classList.add('hidden'); // Force hide invalid
                    validCard.classList.remove('hidden');
                    
                    // Update Content
                    document.getElementById('res-name').textContent = data.student_name;
                    document.getElementById('res-score').textContent = data.score + "%";
                    document.getElementById('res-id').textContent = data.certificate_id || certId;
                    
                    const date = new Date(data.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    document.getElementById('res-date').textContent = date;
                    
                    // Pre-fill input
                    document.getElementById('cert-id-input').value = data.certificate_id || certId;
                    
                    // Animate Progress Bar
                    setTimeout(() => {
                        const progressFill = document.getElementById('res-progress-fill');
                        if (progressFill) {
                            progressFill.style.width = data.score + '%';
                        }
                    }, 300);

                    // Scroll to result
                    container.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                } else {
                    // Invalid Case
                    validCard.classList.add('hidden'); // Force hide valid
                    invalidCard.classList.remove('hidden');
                    container.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            } catch (err) {
                console.error("Verification Error:", err);
                verifyBtn.innerHTML = '<span>Verify Certificate</span><i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>';
                verifyBtn.disabled = false;
                
                container.classList.remove('hidden');
                validCard.classList.add('hidden');
                invalidCard.classList.remove('hidden');
                container.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // QR Scanner Logic
        // Removed camera scanner logic as requested


        function scanFromFile(input) {
            if (input.files.length === 0) return;
            
            const file = input.files[0];
            
            if (file.type === 'application/pdf') {
                handlePdfFile(file);
            } else {
                handleImageFile(file);
            }
        }

        async function handlePdfFile(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                const page = await pdf.getPage(1); // Assume certificate is on first page
                
                // Try multiple scales if one fails
                const scales = [3.0, 4.0, 2.0];
                let found = false;

                for (const scale of scales) {
                    if (found) break;
                    
                    try {
                        console.log(`Trying PDF scan at scale ${scale}...`);
                        const viewport = page.getViewport({ scale: scale });

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        await page.render({
                            canvasContext: context,
                            viewport: viewport
                        }).promise;

                        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                        const imageFile = new File([blob], `cert_render_${scale}.png`, { type: "image/png" });
                        
                        const result = await scanImageFilePromise(imageFile);
                        if (result) {
                            found = true;
                            // Success logic is handled in scanImageFilePromise via callbacks or we can do it here
                            // But scanImageFilePromise is a helper I need to create to return a promise
                        }
                    } catch (e) {
                        console.log(`Failed at scale ${scale}`, e);
                    }
                }

                if (!found) {
                    alert("Could not detect QR code in the PDF. Please try uploading a clearer image or manually enter the Certificate ID.");
                }

            } catch (err) {
                console.error("PDF processing error:", err);
                alert("Could not process PDF file. Please ensure it is a valid PDF.");
            }
        }

        function scanImageFilePromise(imageFile) {
            return new Promise((resolve, reject) => {
                const html5QrCode = new Html5Qrcode("file-reader");
                
                html5QrCode.scanFile(imageFile, true)
                    .then(decodedText => {
                        console.log(`Scan success: ${decodedText}`);
                        html5QrCode.clear();
                        
                        let certId = decodedText;
                        if (decodedText.includes('?id=')) {
                            try {
                                if (decodedText.startsWith('http')) {
                                    const url = new URL(decodedText);
                                    certId = url.searchParams.get("id");
                                } else {
                                    const parts = decodedText.split('?id=');
                                    if (parts.length > 1) certId = parts[1];
                                }
                            } catch(e) {
                                console.log("URL parse error", e);
                            }
                        }
                        
                        verifyCertificate(certId);
                        switchTab('id');
                        resolve(true);
                    })
                    .catch(err => {
                        html5QrCode.clear();
                        console.log("Scan failed for this attempt", err);
                        resolve(false); // Resolve false instead of reject to allow loop to continue
                    });
            });
        }

        function handleImageFile(imageFile) {
            // Wrapper for the original single image upload case
            scanImageFilePromise(imageFile).then(success => {
                if (!success) {
                    alert("No QR code found in file.");
                }
            });
        }

        // Auto-verify if URL has ID param
        window.onload = () => {
            // Hide Global Loader
            const loader = document.getElementById('global-loader');
            if (loader) {
                setTimeout(() => {
                    loader.style.opacity = '0';
                    loader.style.pointerEvents = 'none';
                    setTimeout(() => {
                        loader.remove();
                    }, 700);
                }, 1500); // Display for at least 1.5s to show animation
            }

            // Update Dynamic Year
            const yearSpan = document.querySelector('.dynamic-year');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }

            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (id) {
                document.getElementById('cert-id-input').value = id;
                verifyCertificate(id);
            }
        };

    </script>
</body>
</html>
